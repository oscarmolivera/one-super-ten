<%= turbo_frame_tag "call_up_frame_#{match.id}" do %>
  <%= form_with model: call_up,
                url: call_up.persisted? ? call_up_path(call_up) : match_call_ups_path(match),
                method: call_up.persisted? ? :patch : :post,
                html: {style: "background-color: #f3f5f9; padding: 15px;"},
                data: { turbo_frame: "_top" } do |f| %>

    <%= f.hidden_field :match_id %>
    <%= f.hidden_field :category_id, value: call_up.category_id %>

    <div class="mb-3">
      <%= f.label :name, "Nombre de la Convocatoria" %>
      <%= f.text_field :name, class: "form-control" %>
    </div>

    <div class="row mb-3">
      <div class="col-md-6">
        <%= label_tag :call_up_date_only, "DÃ­a de la Convocatoria", class: "form-label" %>
        <%= date_field_tag :call_up_date_only,
                          call_up.call_up_date&.to_date,
                          class: "form-control",
                          readonly: true, disabled: true%>
      </div>

      <div class="col-md-6">
        <%= label_tag :call_up_time_only, "Hora de la Convocatoria", class: "form-label" %>
        <%= time_field_tag :call_up_time_only,
                          call_up.call_up_date&.strftime("%H:%M"),
                          class: "form-control",
                          placeholder: (@match.scheduled_at - 1.hour).strftime("%H:%M") %>
      </div>
    </div>

    <% if @season_team_players.any? %>
      <div class="mb-3" data-controller="call-up-selector">
        <%= f.label :player_ids, "Jugadores Convocados" %>

        <div class="mb-2">
          <button type="button"
                  class="btn btn-sm btn-outline-secondary"
                  data-action="click->call-up-selector#selectAll">
            Seleccionar Todos
          </button>
        </div>

        <div data-call-up-selector-target="checkboxes">
          <%= f.collection_check_boxes :player_ids, @season_team_players, :player_id, ->(stp) { stp.player&.full_name } do |b| %>
            <div class="form-check">
              <%= b.check_box class: "form-check-input" %>
              <%= b.label class: "form-check-label" %>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="alert alert-info">No hay jugadores disponibles.</div>
    <% end %>

    <div class="mt-3 d-flex gap-2">
      <%= f.submit "Guardar Convocatoria", class: "btn btn-primary" %>
      <button type="button"
              class="btn btn-outline-secondary"
              data-action="click->call-up-cleaner#cleanup click->frame-closer#close">
        Cerrar
      </button>
    </div>

  <% end %>
<% end %>

<style>
  .call-up-form {
    background-color: #;
    padding: 15px;
  }

  .call-up-form .form-check {
    margin-bottom: 0.5rem;
  }

  .call-up-form .form-check-label {
    margin-left: 0.5rem;
  }
</style>