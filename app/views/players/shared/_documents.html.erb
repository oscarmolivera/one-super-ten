<!-- app/views/players/_documents.html.erb -->
<section class="content">
  <div class="box">
    <div class="box-header with-border mb-3">
      <h4 class="box-title">üìÅ Documentos</h4>
    </div>
    <div class="box-body">
      <% if @player.persisted? %>
        <form action="<%= documents_player_path(@player) %>" 
              class="dropzone"
              id="player-files-dropzone"
              method="post"
              enctype="multipart/form-data">
          <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
          <p class="text-muted small mt-1">
            Arrastra y suelta archivos aqu√≠ o haz clic para subir.<br>
            <strong>Formatos permitidos:</strong> PDF, JPG, PNG &nbsp; | &nbsp; <strong>Tama√±o m√°ximo:</strong> 5MB
          </p>
        </form>
        <% if @player.documents.attached? %>
          <hr>
          <h5 class="mt-4 mb-3 fw-bold">üìé Documentos subidos:</h5>
          <div class="d-flex flex-wrap gap-3">
            <% @player.documents.each do |doc| %>
              <div class="player-doc-each" onmouseover="this.style.boxShadow='0 0 10px rgba(0,0,0,0.2)'" onmouseout="this.style.boxShadow='none'">
                <% if doc.image? %>
                  <div class="doc-preview border player-doc-img-preview p-2 mb-2" 
                    data-bs-toggle="modal"
                    data-bs-target="#docModal"
                    data-doc-url="<%= url_for(doc) %>">
                    <%= image_tag doc.variant(resize_to_fill: [160, 120]), class: "w-80 h-80", style: "object-fit: cover;" %>
                  </div>
                <% else %>
                  <div class="d-flex justify-content-center align-items-center bg-light h-140">
                    <i class="fas fa-file-alt fa-2x text-secondary"></i>
                  </div>
                <% end %>
                <div class="px-2 py-2 text-center small bg-white">
                  <%= link_to truncate(doc.filename.to_s, length: 25), "#", 
                      class: "d-block text-decoration-none text-dark", 
                      data: { bs_toggle: "modal", bs_target: "#docModal", doc_url: url_for(doc) } %>
                  <div class="d-flex justify-content-between align-items-center mt-2">
                    <span class="text-muted small"><%= distance_of_time_in_words_to_now(doc.created_at) %></span>
                    <%= link_to "üóë", erase_document_player_path(@player, blob_id: doc.blob.id), 
                        data: { turbo: true, turbo_method: :delete, turbo_confirm: "Are you sure?" },
                        class: "btn btn-sm btn-outline-danger w-100 mt-1" %>
                  </div>  
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</section>

<!-- Modal for Image Preview -->
<div class="modal fade" id="docModal" tabindex="-1" aria-labelledby="docModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="docModalLabel">Vista previa del documento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body text-center">
        <img id="doc-preview-image" src="" alt="Documento" class="img-fluid rounded mhvh-75">
      </div>
    </div>
  </div>
</div>
