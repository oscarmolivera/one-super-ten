<section class="content">
	<div class="row">
		<div class="col-12 col-lg-5 col-xl-4"><!-- Profile Left Side -->
			<div class="box box-widget widget-user"><!-- User Basic Information Card-->
				<div class="widget-user-header bg-img bbsr-0 bber-0 position-relative widget-player-name-bg" data-overlay="5">
					<h3 class="widget-user-username text-white"><%= @player.public_full_name %></h3>
					<% if @player.schools.any? %>
						<div class="d-flex flex-wrap gap-2 mt-2">
							<% @player.schools.each_with_index do |school, i| %>
								<span class="badge-school badge-school-<%= i %>"><%= school.name %></span>
							<% end %>
						</div>
					<% end %>
				</div>
				<div class="widget-user-image">
					<%= player_profile_image(@player, class: 'rounded-circle widget-user-player-image' , alt: "Foto de perfil") %>
				</div>
				<div class="box-footer"><!-- Other Info  & Social Media -->
					<div class="row"><!-- Age DominantSide Category -->
						<div class="col-sm-4">
							<div class="description-block">
								<span class="description-text">Edad</span>
								<h5 class="description-header"><%= "#{@player.age} años" %></h5>
							</div><!-- /.description-block -->
						</div><!-- /.col -->
						<div class="col-sm-4 be-1 bs-1">
							<div class="description-block">
								<span class="description-text">Pie Dominante</span>
								<h5 class="description-header"><%= @player.preferent_side %></h5>
							</div><!-- /.description-block -->
						</div><!-- /.col -->
						<div class="col-sm-4">
							<div class="description-block">
								<span class="description-text">Categoría</span>
								<h5 class="description-header">
									<%= @player.categories.first&.name || "Sin categoría - Revisar" %>
								</h5>
							</div><!-- /.description-block -->
						</div><!-- /.col -->
					</div><!-- /.row -->
					<div class="row"><!-- Social Media Links -->
						<div class="col-12">
							<%= render partial: "player_profiles/shared/social_links", locals: { player: @player } %>
						</div>
					</div>
				</div>
			</div>
			<div class="box box-body px-3 px-md-4"><!-- Player Jersey & Position -->
				<div class="box-group row g-3">
					
					<!-- Jersey Number Card -->
					<div class="col-6">
						<div class="box pull-up rounded-4 border-0 shadow-sm bg-secondary-subtle" style="background-image: url('<%= asset_path('jersey-1.svg')%>');">
							<div class="box-body d-flex flex-column justify-content-between min-h-150">
								<div class="text-start">
									<h5 class="fw-bold text-dark mb-1">Dorsal</h5>
									<p class="text-muted small mb-2">Temporada 2025</p>
								</div>
								<div class="jersey-number-box text-center bg-white text-dark fw-bold rounded-pill px-3 py-2 mx-auto h1">
									<%= @player.jersey_selection.presence || "-" %>
								</div>
							</div>
						</div>
					</div>

					<!-- Position Card -->
					<div class="col-6">
						<div class="box pull-up rounded-4 border-0 shadow-sm bg-warning-subtle position-card-bg-rule" style="background-image: url('<%= asset_path(position_background_image(@player))%>');">
							<div class="box-body d-flex flex-column justify-content-between min-h-150">
								<div class="text-start">
									<h5 class="fw-bold text-dark mb-1"><%= @player.public_position %></h5>
									<p class="text-muted small mb-0">Posición</p>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
			<div class="box"><!-- Player TeamMates -->
				<div class="box-body">
					<div class="flexbox align-items-baseline mb-20">
						<h6 class="text-uppercase ls-2 ">
							<% if user_signed_in? %>
								<%= link_to 'Mi Categoría', teammates_player_path(@player), class: 'text-decoration-none' %>
							<% else %>
								<span class="text-muted">Mi Categoría</span>
							<% end %>
						</h6>
						
						<small><%= @player.teammates_number %></small>
					</div>
					<div class="gap-items-2 gap-y">
						<% if user_signed_in? %>
							<% @teammates.shuffle.first(10).each do |teammate| %>
								<%= link_to player_player_profile_path(teammate), class: "avatar", title: teammate.full_name do %>
									<% if teammate.profile_picture.attached? %>
										<%= image_tag teammate.profile_picture.variant(resize_to_fill: [40, 40]), class: "rounded-circle", alt: teammate.full_name %>
									<% else %>
										<%= image_tag 'profile-placeholder.webp', class: "rounded-circle", width: 40, height: 40, alt: "Sin foto" %>
									<% end %>
								<% end %>
							<% end %>

							<% if @teammates.count > 7 %>
								<%= link_to "+#{@teammates.count - 10}", teammates_player_path(@player), class: "avatar avatar-more", title: "Ver todos" %>
							<% end %>
						<% else %>
							<% @teammates.shuffle.first(10).each do |teammate| %>
								<% if teammate.handle.present? && teammate.public_profile? %>
									<%= link_to public_player_path(teammate.handle), class: "avatar", title: teammate.full_name do %>
										<%= teammate_avatar(teammate) %>
									<% end %>
									<% if @teammates.count > 7 %>
										<%= link_to "+#{@teammates.count - 10}", teammates_player_path(@player), class: "avatar avatar-more", title: "Ver todos" %>
									<% end %>
								<% else %>
									<span class="avatar" title="<%= teammate.public_full_name %>">
										<%= teammate_avatar(teammate) %>
									</span>
								<% end %>
							<% end %>
						<% end %>
					</div>
				</div>
			</div><!-- /.box -->
		</div><!-- /.col-12 Left Side -->

		<div class="col-12 col-lg-7 col-xl-8"><!-- Profile Right Side -->
			<div class="nav-tabs-custom">
				<ul class="nav nav-pills mb-5">
					<li class=" nav-item"> <a href="#publicprofile" class="nav-link active" data-bs-toggle="tab" aria-expanded="false">Perfil Publico</a> </li>
					<% if user_signed_in? && policy(@player).edit? %>
						<li class="nav-item"> <a href="#editprofile" class="nav-link" data-bs-toggle="tab" aria-expanded="false">Editar Perfil</a> </li>
						<li class="nav-item"> <a href="#playerinfo" class="nav-link" data-bs-toggle="tab" aria-expanded="false">Ficha Jugador</a> </li>
					<% end %>
				</ul>

				<div class="tab-content">
					<div class="active tab-pane" id="publicprofile">
						<%= render 'player_profiles/shared/public_profile' %>
					</div><!-- /.tab-pane publicprofile-->
					<% if user_signed_in? && policy(@player).edit? %>
						<div class="tab-pane" id="editprofile">
							<%= render 'player_profiles/shared/edit_profile' %>
						</div><!-- /.tab-pane editprofile-->
						<div class="tab-pane" id="playerinfo">
							<%= render 'player_profiles/shared/player_info' %>
						</div><!-- /.tab-pane editprofile-->
					<% end %>
				</div><!-- /.tab-content -->
			</div><!-- /.nav-tabs-custom -->
		</div><!-- /.col-12 Right Side -->
	</div><!-- /.row -->
</section>
