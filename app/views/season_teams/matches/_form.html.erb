<%= form_with( model: match,
                url: match.new_record? ? season_team_matches_path(season_team) : match_path(match),
                method: match.new_record? ? :post : :patch,
                data: { turbo_frame: "new_match_form" },
                html: { multipart: true }
              ) do |f| %>

  <div class="card shadow border-0">
    <!-- Card Header -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-trophy me-2"></i> <%= season_team.tournament.name %></h5>
      <span class="badge bg-light text-dark">Etapa: <%= match_stage(season_team.stages.last) %></span>
    </div>

    <!-- Card Body -->
    <div class="card-body">
      <div class="row g-4">

        <!-- Plays As -->
        <div class="col-12">
          <label class="form-label d-block fw-bold">Jugar como:</label>
          <div class="btn-group" role="group" aria-label="Plays As">
            <%= f.radio_button :plays_as, 'home', class: "btn-check ", id: "plays_home", autocomplete: "off" %>
            <label class="btn btn-outline-success h-40" for="plays_home">
              <i class="bi bi-house-door-fill me-1"></i> Local
            </label>

            <%= f.radio_button :plays_as, 'away', class: "btn-check ", id: "plays_away", autocomplete: "off" %>
            <label class="btn btn-outline-secondary h-40" for="plays_away">
              <i class="bi bi-bus-front-fill me-1"></i> Visitante
            </label>
          </div>
        </div>

        <!-- Rival -->
        <div class="col-md-6">
          <%= f.label :rival_id, "Equipo Rival", class: "form-label fw-bold" %>
          <%= f.collection_select :rival_id,
                                  season_team.rivals, :id, :name,
                                  { prompt: 'Seleccione Rival' },
                                  class: 'form-select', required: true %>
        </div>

        <!-- Location -->
        <div class="col-md-6">
          <%= f.label :location, "Ubicación", class: "form-label fw-bold" %>
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-geo-alt-fill"></i></span>
            <%= f.text_field :location, class: "form-control", placeholder: "Ej: Estadio Central" %>
          </div>
        </div>

        <!-- Scheduled At -->
        <div class="col-md-6">
          <%= f.label :scheduled_at, "Día y Hora", class: "form-label fw-bold" %>
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-calendar-event"></i>
            </span>
            <%= f.datetime_local_field :scheduled_at, class: "form-control", placeholder: "YYYY-MM-DD HH:MM" %>
          </div>
          <small class="text-muted">Seleccione la fecha y hora programada.</small>
        </div>

        <!-- Match Type -->
        <div class="col-md-6">
          <%= f.label :match_type, "Tipo de Partido", class: "form-label fw-bold" %>
          <%= f.select :match_type,
                      options_for_select([["Amistoso", "friendly"], ["Torneo", "tournament"], ["Práctica", "practice"]], match.match_type),
                      { prompt: "Seleccionar tipo" },
                      class: "form-select" %>
        </div>     

        <!-- Location Type -->
        <div class="col-md-6">
          <%= f.label :location_type, "Tipo de Ubicación", class: "form-label fw-bold" %>

          <%= f.select :location_type,
            options_for_select(
              [
                ["Campo Local", "home_field"],
                ["Campo Visitante", "away_field"],
                ["Campo Neutral", "neutral"]
              ],
              # Valor preseleccionado:
              match.location_type.presence || (match.plays_as == "home" ? "home_field" : (match.plays_as == "away" ? "away_field" : nil))
            ),
            { prompt: "Seleccionar tipo de ubicación" },
            class: "form-select" %>
        </div>

        <!-- Notes -->
        <div class="col-md-6">
          <%= f.label :notes, "Notas del Partido (Opcional)", class: "form-label fw-bold" %>
          <%= f.text_area :notes, rows: 3, class: "form-control", placeholder: "Detalles adicionales del partido..." %>
        </div>

      </div>
    </div>

    <!-- Card Footer -->
    <div class="card-footer bg-light d-flex justify-content-between align-items-center">
      <!-- Hidden Fields -->
      <%= f.hidden_field :stage_id, value: season_team.stages.last.id %>
      <%= f.hidden_field :tournament_id, value: season_team.tournament_id %>
      <%= f.hidden_field :team_of_interest_id, value: season_team.id %>

      <%= f.submit "Guardar Partido", class: "btn btn-primary px-4" %>
    </div>
  </div>

<% end %>