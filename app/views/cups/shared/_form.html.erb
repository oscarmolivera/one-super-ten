<div class="container mt-4">
  <h1><%= action_name == "new" ? "Nueva Copa" : "Editar Copa" %></h1>

  <%= form_with(model: @cup, local: true, html: { multipart: true, data: { controller: "image-preview" } }) do |f| %>
    
    <div class="form-group mb-3">
      <%= f.label :name, 'Nombre de la Copa' %>
      <%= f.text_field :name, class: 'form-control' %>
    </div>

    <div class="form-group mb-3">
      <%= f.label :logo, 'Logo de la Copa' %><br>

      <% if @cup.logo.attached? %>
        <div class="mb-2">
          <%= image_tag @cup.logo.variant(resize_to_limit: [200, 200]), data: { image_preview_target: "preview" }, class: "rounded shadow-sm border", id: "cup-logo-preview", style: "max-height: 200px; object-fit: contain;" %>
          <small class="text-muted d-block mt-1" data-image-preview-target="filename">
            Archivo actual: <%= @cup.logo.filename.to_s %>
          </small>
        </div>
      <% else %>
        <%= image_tag "", data: { image_preview_target: "preview" }, id: "cup-logo-preview", class: "d-none img-fluid rounded shadow-sm border", style: "max-height: 200px; object-fit: contain;" %>
        <small class="text-muted d-block mt-1 d-none" data-image-preview-target="filename"></small>
      <% end %>

      <%= f.file_field :logo, class: 'form-control', data: { image_preview_target: "input", action: "change->image-preview#previewImage" } %>
    </div>

    <div class="form-group mb-3">
      <%= f.label :description, 'DescripciÃ³n' %>
      <%= f.text_field :description, class: 'form-control', placeholder: 'Organizador / Sponsor / Slogan ' %>
    </div>

    <div class="form-group mb-3">
      <%= f.label :location, 'Lugar' %>
      <%= f.text_field :location, class: 'form-control', placeholder: 'Colocar Ciudad, Estado'%>
    </div>

    <div class="form-group mb-3">
      <%= f.label :school_id, 'Escuela' %>
      <%= f.hidden_field :school_id, value: @cup.school_id %>
      <%= text_field_tag :school_name, @cup.school&.name, class: 'form-control', disabled: true %>
    </div>

    <%= f.submit (action_name == "new" ? "Crear Copa" : "Actualizar Copa"), class: 'btn btn-primary mt-2' %>
  <% end %>

  <div class="d-flex justify-content-end">
    <%= link_to "Volver", cups_path(anchor: "school-pane-#{@cup.school_id}"), class: "btn btn-secondary mt-3 float-end" %>
  </div>
</div>